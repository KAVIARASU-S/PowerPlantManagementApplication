<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="Responsive Admin &amp; Dashboard Template based on Bootstrap 5">
	<meta name="author" content="AdminKit">
	<meta name="keywords" content="adminkit, bootstrap, bootstrap 5, admin, dashboard, template, responsive, css, sass, html, theme, front-end, ui kit, web">

	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link rel="shortcut icon" href="img/icons/Power_Plant_logo.jpeg" />

	<link rel="canonical" href="https://demo-basic.adminkit.io/pages-blank.html" />
	<link rel="canonical" href="https://demo-basic.adminkit.io/charts-chartjs.html" />

	<title>Accounting</title>

	<link href="css/app.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
	<script src="./mycode/js/authorization.js"></script>

</head>

<body>
	<div class="wrapper">
		<nav id="sidebar" class="sidebar js-sidebar">
			<div class="sidebar-content js-simplebar">
		
				<a class="sidebar-brand" href="#">
					<span class="align-middle">Optimus Power</span>
				</a>

				<ul class="sidebar-nav">

					<li id="superadmindashboard0" class="sidebar-item">
						<a class="sidebar-link" href="dashboard-superadmin.html">
			  <i class="align-middle" data-feather="sliders"></i> <span class="align-middle">Dashboard</span>
			</a>
					</li>

					<li id="dashboard0" class="sidebar-item">
						<a class="sidebar-link" href="index.html">
							<i class="align-middle" data-feather="sliders"></i> <span
								class="align-middle">Dashboard</span>
						</a>
					</li>

					<li id="roi0" class="sidebar-item">
						<a class="sidebar-link" href="pages-roi.html">
							<i class="align-middle" data-feather="grid"></i> <span class="align-middle">ROI</span>
						</a>
					</li>



					<li id="users0" class="sidebar-item">
						<a class="sidebar-link" href="pages-users.html">
							<i class="align-middle" data-feather="user"></i> <span class="align-middle">Users</span>
						</a>
					</li>

					<li id="ipaddress0" class="sidebar-item">
						<a class="sidebar-link" href="pages-ipaddress.html">
							<i class="align-middle" data-feather="map-pin"></i> <span class="align-middle">IP
								Address</span>
						</a>
					</li>

					<li id="accounting0" class="sidebar-item active">
						<a class="sidebar-link" href="pages-accounting.html">
							<i class="align-middle" data-feather="layers"></i> <span
								class="align-middle">Accounting</span>
						</a>
					</li>

					<li id="transactions0" class="sidebar-item">
						<a class="sidebar-link" href="../accounting/accounting.html">
							<i class="align-middle" data-feather="dollar-sign"></i> <span
								class="align-middle">Transactions</span>
						</a>
					</li>


					<li id="tasks0" class="sidebar-item">
						<a class="sidebar-link" href="pages-tasks.html">
							<i class="align-middle" data-feather="crosshair"></i> <span
								class="align-middle">Tasks</span>
						</a>
					</li>

					<li id="inventory0" class="sidebar-item">
						<a class="sidebar-link" href="pages-inventory.html">
              <i class="align-middle" data-feather="box"></i> <span class="align-middle">Inventory</span>
            </a>
					</li>

					<li id="purchase0" class="sidebar-item">
						<a class="sidebar-link" href="pages-purchase.html">
              <i class="align-middle" data-feather="download"></i> <span class="align-middle">Purchase</span>
            </a>
					</li>


					<li id="livedata0" class="sidebar-item">
						<a class="sidebar-link" href="pages-livedata.html">
              <i class="align-middle" data-feather="activity"></i> <span class="align-middle">Live Data</span>
            </a>
					</li>

					<li id="sensors0" class="sidebar-item">
						<a class="sidebar-link" href="pages-sensors.html">
              <i class="align-middle" data-feather="compass"></i> <span class="align-middle">Sensors</span>
            </a>
					</li>

					<li id="calculator0" class="sidebar-item">
						<a class="sidebar-link" href="pages-calculations.html">
			  <i class="align-middle" data-feather="grid"></i> <span class="align-middle">Calculator</span>
			</a>
					</li>

					

				</ul>

				
			</div>
		</nav>

		<div class="main">
			<nav class="navbar navbar-expand navbar-light navbar-bg">
				<a class="sidebar-toggle js-sidebar-toggle">
          <i class="hamburger align-self-center"></i>
        </a>

				<div class="navbar-collapse collapse">
					<ul class="navbar-nav navbar-align">
						
							<li class="nav-item dropdown">
								<a class="nav-icon dropdown-toggle d-inline-block d-sm-none" href="#" data-bs-toggle="dropdown">
					<i class="align-middle" data-feather="settings"></i>
				  </a>
	
				  <a class="nav-link dropdown-toggle d-none d-sm-inline-block" href="#"
				  data-bs-toggle="dropdown">
				  <img src="img/avatars/avatar.png" class="avatar img-fluid rounded me-1"
					  alt="Admin" /> <span id="adminName" class="text-dark"></span>
			  </a>
			  <script>
				  document.addEventListener( 'DOMContentLoaded', function (){
					  let username = localStorage.getItem('username')
					  if (username === null){
					  document.getElementById("adminName").innerHTML = "Not Logged In";
					  window.location.href = "../Notloggedin/notLoggedin.html"
					  return;
					  }
					  document.getElementById("adminName").innerHTML = username;
					  
				  })
			  </script>
				  <div class="dropdown-menu dropdown-menu-end" style="min-width: 10px;border-radius: 10px;margin-right: 2%;">
					<a class="dropdown-item" href="#" onclick="logout()" style="color: red;">Log out</a>
				</div>
				<script src="./mycode/js/logout.js"></script>
							</li>
					</ul>
				</div>
			</nav>

			<main class="content">
				<div class="container-fluid p-0">

					<h1 class="h3 mb-3">Accounting Dashboard</h1>

					<div class="row">
						<div class="col-12">
							<div class="card">
								<div class="card-header">
									<h5 class="card-title mb-0">Accounting Dashboard</h5>
								</div>
								
								<div class="card-body">
									<h4 id="error-message" style="color: rgb(243, 72, 72);"></h4><br>

									<div style="display: flex;justify-content: space-between;">
									<div>
									<h3>Total Income: &#x20B9 <span id="totalIncome"></span></h3>
								</div>
								<div>
									<h3>Total Expense: &#x20B9 <span id="totalExpense"></span> </h3>
								</div>
								<div>
									<h3>Profit :  <span id="profit"></span> </h3>
									</div>
									</div>
							

									
		

							<script>
    let income = [];
    let expense = [];
    let incomeDate = [];
    let expenseDate = [];
	let totalIncome;
	let totalExpense;
	let profit = 0;
	let color;

    document.addEventListener("DOMContentLoaded", function() {
        displayAccounting();
    });

    function displayAccounting() {
		let companyName = localStorage.getItem('company');
		if (companyName == null){
			document.getElementById("error-message").innerText = "Login to view your accounting details.";
			return;
		}
						searchFilter = {
							CompanyName:companyName,
						}
        fetch('http://localhost:2000/displayAccounting',{
			method: 'POST',
			headers: {
			'Content-Type': 'application/json'
			},
			body: JSON.stringify(searchFilter)
		})
            .then(response => {
                if (!response.ok) {
                    document.getElementById("error-message").innerText = "Unable to connect to server";
                    throw new Error('Unable to connect to server');
                }
                return response.json();
            })
            .then(data => {
				console.log("data returned",data)
				if (data === null){
                    document.getElementById("error-message").innerText = "No transaction done";
					return;
				}
				if (data.Incomes === null && data.Expenses === null){
                    document.getElementById("error-message").innerText = "No transactions done";
					return;
				}
                if (!data || data.length === 0) {
                    document.getElementById("error-message").innerText = "No transaction done";
					return;
                }

				totalIncome = data.TotalIncome;
				document.getElementById("totalIncome").innerText = totalIncome;

				totalExpense = data.TotalExpense;
				document.getElementById("totalExpense").innerText = totalExpense;

				profit = data.Profit;

				if (profit > 0){
					color = "green";
				}else{
					color = "red";
				}

				document.getElementById("profit").innerText = "â‚¹" + " "+ profit;
				document.getElementById("profit").style.color= color;

				if (data.Incomes != null){
                data.Incomes.forEach(transaction => {
                    if (!transaction) {
                        console.error('Invalid item data:', transaction);
                        return;
                    }
                    let newDate = new Date(transaction.Date);
                    let formattedDate = newDate.toLocaleDateString('en-GB');

                        income.push(transaction.Amount);
                        incomeDate.push(formattedDate);
                });
			}

			if (data.Expenses != null){
				data.Expenses.forEach(transaction => {
					if (!transaction) {
                        console.error('Invalid item data:', transaction);
                        return;
                    }
					let newDate = new Date(transaction.Date);
                    let formattedDate = newDate.toLocaleDateString('en-GB');

					expense.push(transaction.Amount);
                    expenseDate.push(formattedDate);
				})
			}

                plotIncomeChart();
                plotExpenseChart();
            })
            .catch(error => {
                document.getElementById("error-message").innerText = "Unable to connect to server";
                console.error('Error:', error);
            });
    }

    function plotIncomeChart() {
        new Chart(document.getElementById("chartjs-line"), {
            type: "line",
            data: {
                labels: incomeDate,
                datasets: [{
                    label: "Income (â‚¹)",
                    fill: true,
                    backgroundColor: "transparent",
                    borderColor: "#07f517",
                    data: income
                }],
            },
            options: {
                maintainAspectRatio: false,
                legend: {
                    display: false
                },
                tooltips: {
                    intersect: false
                },
                hover: {
                    intersect: true
                },
                plugins: {
                    filler: {
                        propagate: false
                    }
                },
                scales: {
                    xAxes: [{
                        reverse: true,
                        gridLines: {
                            color: "rgba(0,0,0,0.05)"
                        }
                    }],
                    yAxes: [{
                        ticks: {
                            stepSize: 500
                        },
                        display: true,
                        borderDash: [5, 5],
                        gridLines: {
                            color: "rgba(0,0,0,0)",
                            fontColor: "#fff"
                        }
                    }]
                }
            }
        });
    }

    function plotExpenseChart() {
        new Chart(document.getElementById("chartexpensejs-line"), {
            type: "line",
            data: {
                labels: expenseDate,
                datasets: [{
                    label: "Expenses (â‚¹)",
                    fill: true,
                    backgroundColor: "transparent",
                    borderColor: "red",
                    data: expense
                }],
            },
            options: {
                maintainAspectRatio: false,
                legend: {
                    display: false
                },
                tooltips: {
                    intersect: false
                },
                hover: {
                    intersect: true
                },
                plugins: {
                    filler: {
                        propagate: false
                    }
                },
                scales: {
                    xAxes: [{
                        reverse: true,
                        gridLines: {
                            color: "rgba(0,0,0,0.05)"
                        }
                    }],
                    yAxes: [{
                        ticks: {
                            stepSize: 500
                        },
                        display: true,
                        borderDash: [5, 5],
                        gridLines: {
                            color: "rgba(0,0,0,0)",
                            fontColor: "#fff"
                        }
                    }]
                }
            }
        });
    }
</script>

									
							
								</div>
								<div class="card-body" style="height: 250px;">
									<h3 class="card-title mb-0">Income</h3>
									<canvas id="chartjs-line"></canvas>
								</div>
								
								<div class="card-body" style="height: 250px;">
									<h4 class="card-title mb-0">Expense</h4>
									<canvas id="chartexpensejs-line"></canvas>
								</div>
							</div>
						</div>
					</div>

				</div>
			</main>

			<footer class="footer">
				<div class="container-fluid">
					<div class="row text-muted">
						<div class="col-6 text-start">
							<p class="mb-0">
								<a class="text-muted"  target="_blank"><strong>Optimus Power</strong></a> - <a class="text-muted"  target="_blank"><strong>Powerplant Management Application</strong></a>								&copy;
							</p>
						</div>
						
					</div>
				</div>
			</footer>
		</div>
	</div>

	<script src="js/app.js"></script>

</body>

</html>